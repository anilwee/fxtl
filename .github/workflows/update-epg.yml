      - name: Filter ONLY Foxtel channels and remove "AU - " prefix completely
        run: |
          echo "ðŸ” Starting aggressive Foxtel-only filtering..."
          
          # Create a Python script for robust XML processing
          cat > public/filter_epg.py << 'PYTHON_SCRIPT'
          import xml.etree.ElementTree as ET
          import re
          import sys

          # Parse the XML file (handle namespaces)
          try:
              tree = ET.parse('public/raw_epg.xml')
              root = tree.getroot()
              
              # Handle namespace if present
              namespace = ''
              if root.tag.startswith('{'):
                  namespace = root.tag.split('}')[0] + '}'
                  print(f"Found namespace: {namespace}")
              
              # Define channel tags with namespace
              channel_tag = f"{namespace}channel" if namespace else "channel"
              programme_tag = f"{namespace}programme" if namespace else "programme"
              display_name_tag = f"{namespace}display-name" if namespace else "display-name"
              
              # Define Foxtel channel patterns (what to KEEP)
              foxtel_patterns = [
                  'FOX', 'ESPN', 'SKY NEWS', 'SKY RACING', 'SKY SPORTS',
                  'DISCOVERY', 'LIFESTYLE', 'MOVIE', 'BBC', 'NICK', 
                  'DISNEY', 'COMEDY', 'CRIME', 'DOCOS', 'ARENA',
                  'SPORTS', 'KAYO', 'A&E', 'TLC', 'SYFY', 'PARAMOUNT',
                  'BRAVO', 'MTV', 'CNBC', 'CNN', 'NATIONAL GEOGRAPHIC',
                  'ANIMAL PLANET', 'UKTV', 'BOX', 'MAX', 'STUDIO',
                  'PREMIER', 'RACING', 'OUTDOOR', 'WARNER', 'UNIVERSAL',
                  '13TH', 'E!', 'SYFY', 'CARTON', 'CBeebies', 'BOLD',
                  'PEACH', 'SHAKE', 'MATE', 'FLIX', 'GEM', 'GO', 'LIFE',
                  'RUSH', 'HITS', 'ONE', 'SHOWCASE',
                  'CRICKET', 'FOOTY', 'LEAGUE', 'THEATRE', 'ARTS',
                  'ULTRA', 'HD', 'KIDS', 'JR', 'XD', 'PLUS', 'ON DEMAND'
              ]
              
              # Australian FTA channels to REMOVE (explicitly filter these out)
              fta_channels = [
                  'ABC', 'SBS', '7', '9', '10', 'NITV', 'VICELAND',
                  '7TWO', '7MATE', '7FLIX', '9GEM', '9GO', '9LIFE',
                  '10 BOLD', '10 PEACH', '10 SHAKE'
              ]
              
              # Function to check if channel is Foxtel (NOT FTA)
              def is_foxtel_channel(channel_id, display_text):
                  # Convert to uppercase for comparison
                  channel_id_upper = str(channel_id).upper() if channel_id else ''
                  display_upper = str(display_text).upper() if display_text else ''
                  combined = channel_id_upper + ' ' + display_upper
                  
                  # First check: If it contains any FTA pattern, reject it
                  for fta in fta_channels:
                      if fta in combined:
                          # But make sure it's not part of a Foxtel channel
                          # e.g., "FOX CRICKET" should not be rejected because of "CRICKET"
                          if 'FOX' not in combined and 'ESPN' not in combined:
                              return False
                  
                  # Second check: Must match at least one Foxtel pattern
                  for pattern in foxtel_patterns:
                      if pattern in combined:
                          return True
                  
                  # Third check: Numeric channels (100-999) are likely Foxtel
                  numbers = re.findall(r'\b\d{3}\b', combined)
                  if numbers:
                      return True
                  
                  return False
              
              # Create new root
              new_root = ET.Element(root.tag, root.attrib)
              
              # First pass: collect all Foxtel channel IDs
              foxtel_ids = set()
              channels_kept = 0
              
              for channel in root.findall(channel_tag):
                  channel_id = channel.get('id', '')
                  
                  # Get display name text
                  display_name_elem = channel.find(display_name_tag)
                  display_text = display_name_elem.text if display_name_elem is not None else ''
                  
                  if is_foxtel_channel(channel_id, display_text):
                      # Clone the channel but clean the display name
                      new_channel = ET.Element(channel_tag, channel.attrib)
                      
                      # Copy all subelements but clean display-name
                      for elem in channel:
                          new_elem = ET.SubElement(new_channel, elem.tag, elem.attrib)
                          if elem.text:
                              if elem.tag.endswith('display-name'):
                                  # Clean the display name - remove "AU - " prefix completely
                                  cleaned_text = elem.text
                                  
                                  # Print original for debugging
                                  print(f"Original: '{cleaned_text}'")
                                  
                                  # Remove "AU - " prefix (with various spacings)
                                  cleaned_text = re.sub(r'^AU\s*-\s*', '', cleaned_text)  # Removes "AU - ", "AU-", "AU -"
                                  cleaned_text = re.sub(r'^AU\s+', '', cleaned_text)      # Removes "AU " (just in case)
                                  
                                  # Also remove any standalone "- " that might remain
                                  cleaned_text = re.sub(r'^-\s+', '', cleaned_text)
                                  
                                  # Trim any remaining whitespace
                                  cleaned_text = cleaned_text.strip()
                                  
                                  print(f"Cleaned:  '{cleaned_text}'")
                                  print("---")
                                  
                                  new_elem.text = cleaned_text
                              else:
                                  new_elem.text = elem.text
                          else:
                              new_elem.text = elem.text
                      
                      new_root.append(new_channel)
                      foxtel_ids.add(channel_id)
                      channels_kept += 1
              
              print(f"âœ… Kept {channels_kept} Foxtel channels")
              
              # Second pass: add programmes for kept channels
              programmes_kept = 0
              for programme in root.findall(programme_tag):
                  prog_channel = programme.get('channel', '')
                  
                  if prog_channel in foxtel_ids:
                      new_root.append(programme)
                      programmes_kept += 1
              
              print(f"âœ… Kept {programmes_kept} programmes")
              
              # Write the new XML with proper formatting
              from xml.dom import minidom
              rough_string = ET.tostring(new_root, 'utf-8')
              reparsed = minidom.parseString(rough_string)
              
              # Add XML declaration and DOCTYPE
              with open('public/fxtl.xml', 'wb') as f:
                  f.write(b'<?xml version="1.0" encoding="utf-8"?>\n')
                  f.write(b'<!DOCTYPE tv SYSTEM "xmltv.dtd">\n')
                  pretty_xml = reparsed.toprettyxml(indent="  ", encoding='utf-8')
                  # Remove the duplicate XML declaration that minidom adds
                  pretty_xml = pretty_xml.replace(b'<?xml version="1.0" encoding="utf-8"?>\n', b'', 1)
                  f.write(pretty_xml)
              
              print("âœ… Filtered EPG written to public/fxtl.xml")
              
              # Verification
              print("\n=== SAMPLE CLEANED CHANNELS ===")
              with open('public/fxtl.xml', 'r') as f:
                  lines = f.readlines()
                  sample_count = 0
                  for line in lines:
                      if '<display-name>' in line and sample_count < 20:
                          print(line.strip())
                          sample_count += 1
              
          except Exception as e:
              print(f"Error processing XML: {e}")
              import traceback
              traceback.print_exc()
              sys.exit(1)
          PYTHON_SCRIPT

          # Run the Python script
          python3 public/filter_epg.py
          
          # Final cleanup with sed to catch any remaining patterns
          echo "Running final cleanup passes..."
          
          # Remove "AU - " pattern
          sed -i 's/<display-name>AU - /<display-name>/g' public/fxtl.xml
          
          # Remove "AU-" pattern
          sed -i 's/<display-name>AU-/<display-name>/g' public/fxtl.xml
          
          # Remove "AU " pattern
          sed -i 's/<display-name>AU /<display-name>/g' public/fxtl.xml
          
          # Remove any standalone "- " that might remain at the beginning
          sed -i 's/<display-name>- /<display-name>/g' public/fxtl.xml
          sed -i 's/<display-name> - /<display-name>/g' public/fxtl.xml
          
          # Final trim of any double spaces
          sed -i 's/  / /g' public/fxtl.xml
          
          echo "Final verification:"
          grep '<display-name>' public/fxtl.xml | head -20
