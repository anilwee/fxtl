name: Foxtel EPG Generator

on:
  workflow_dispatch:
  schedule:
    - cron: "0 2 * * *"

jobs:
  generate-epg:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Mono
        run: |
          sudo apt-get update
          sudo apt-get install -y mono-complete unzip wget

      - name: Download WebGrab+Plus
        run: |
          wget https://webgrabplus.com/sites/default/files/download/SW/V5.5.0/WebGrabPlus_5.5_install.tar.gz
          tar -xzf WebGrabPlus_5.5_install.tar.gz
          cd .wg++
          chmod +x install.sh
          ./install.sh
          echo "$PWD" >> $GITHUB_PATH

      - name: Copy config
        run: |
          mkdir -p config
          cp WebGrab++.config.xml config/

      - name: Run WebGrab+Plus
        run: |
          cd config
          mono ../.wg++/WebGrab+Plus.exe

      - name: Copy EPG
        run: |
          mkdir -p public
          cp config/guide.xml public/epg.xml

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
